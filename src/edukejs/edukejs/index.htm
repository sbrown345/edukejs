<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>EDukeJS</title>
    <style>body{margin:0;}</style>
</head>
<body>
    <script src="libs/long.js"></script>
    <script src="libs/webgl-debug.js"></script>
    <script src="libs/lightgl.js"></script>
    <script src="eduke.js"></script>

    <script>
        // async: https://github.com/AndrewGaspar/Async-Await-Proposal-for-TypeScript/tree/master/Code-Generation

        path("index.htm");

        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'DUKE3D.GRP', true);
        xhr.responseType = 'arraybuffer';

        xhr.onload = function (e) {
            loadGame(new Uint8Array(this.response));
        };

        xhr.send();

        function loadGame(grpData) {
            path("index.htm loaded grp");

            if(grpData.length != hardcoded.grpSize) {
                throw "Incorrect file size for " + (shareware ? "demo" : "full") + " grp";
            }
            
            fileHandles[4] = new Ptr(grpData);
            var commandLine = "-nosetup -map ";
            commandLine += window.location.search ? window.location.search.substr(1) + ".MAP" : "E1L2.MAP";
            WinMain(null, null, commandLine, 10);
        }
    </script>
</body>
</html>
